<article id="6578a664a6475c272d5aa8f4" data-filter-tag="javascript" class="post">
    <time datetime="2023-12-02">2023-12-02</time>
    <h1>Converting Multi-Page apps to Single-Page apps using nothing but Vanilla JS</h1>
    <div class="tags">
      <span>javascript</span>
    </div>
    <div class="content">
      <p>If you want to build a SPA (single page application) from a MPA (multi page application) you don&#39;t always need a giant framework. What you need mainly is to set an event handler on your links to disable their default behaviour, then invoke the function that updates your page, and lastly push a new history to browser history to update the URL without refreshing the page. Below is example of a typescript function that does this:</p>
<pre><code class="language-javascript">function enableSpaMode() {
    document.querySelector(&#39;main&#39;)?.addEventListener(&#39;click&#39;, (e) =&gt; {
        const link = e.target as HTMLAnchorElement;
        if (link.nodeName === &#39;A&#39;) {
            e.preventDefault();
            const href = link.getAttribute(&#39;href&#39;)!;
    
            // Do nothing when link to current page is clicked
            if (link.search === window.location.search) {
                return;
            }
    
            // update state using queries in link
            const params = new URLSearchParams(link.search);
            if (params.size &gt; 0) {
                for (const [key, value] of params) {
                    state[key] = value;
                }
            }
    
            // invoke function that updates your page
            render(state);
    
            // update browser history and url
            window.history.pushState(state, &#39;&#39;, href);
        }
    });
    
    // add support for browser back button
    window.addEventListener(&quot;popstate&quot;, function(e) {
        render(e.state);
    });
}
</code></pre>
<p>Since when user lands on your app for the first time, browser automatically stores the history without a state, we need to replace that history after app has updated the state and rendered the page by calling history&#39;s replaceState method:</p>
<pre><code class="language-javascript">window.history.replaceState(state, &#39;&#39;, window.location.search);
</code></pre>
<p>There is one little problem however and that is if someone uses browser back button to navigate back to a previous page browser won&#39;t show the page in exact scrolling position that it was when user left that page. To solve this problem we need to update the state in browser history by storing scroll position there before we make render a new page. We can achieve that using this:</p>
<pre><code class="language-javascript">// replace existing history state with one that has scrolling position
const scrollPosition = document.documentElement.scrollTop;
const tempState = {...history.state, scroll: scrollPosition};
history.replaceState(tempState, &#39;&#39;, window.location.search);
</code></pre>
<p>Then when popState event fires we get the scroll position from state and scroll to that:</p>
<pre><code class="language-javascript">window.addEventListener(&quot;popstate&quot;, async (event) =&gt; {
    await renderPage(event.state);
    if (event.state.scroll) {
        window.scrollTo(0, event.state.scroll);
    }
});
</code></pre>
<p>Full script:<br><a href="https://github.com/smohadjer/pokerrangliste/blob/master/public/ts/index.ts">https://github.com/smohadjer/pokerrangliste/blob/master/public/ts/index.ts</a></p>
<p>SPA demo:<br><a href="https://tournaments.myendpoint.de/">https://tournaments.myendpoint.de/</a></p>
<p><a href="https://github.com/smohadjer/pokerrangliste">GitHub repository</a></p>

    </div>
  </article>