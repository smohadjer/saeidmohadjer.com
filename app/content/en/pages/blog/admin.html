<main>
	<article>
		<button id="new-post">Reset Form</button>
		Edit:
		<select>

		</select>

		<p><a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet#emphasis">Markdown Cheatsheet</a></p>
		<form action="/api/blog" method="POST">
			<p>Fields marked with <strong>*</strong> are required.</p>
			<div class="row row--two-columns required">
				<label for="date">Date</label>
				<input required type="date" name="date">
			</div>
			<div class="row row--two-columns required">
				<label for="title">Title</label>
				<input required name="title">
			</div>
			<div class="row row--two-columns">
				<label for="tag">Tag</label>
				<input list="tags" name="tag">
				<span>Only one tag is allowed</span>
				<datalist id="tags">
					<option value="authentication">authentication</option>
					<option value="javascript">javascript</option>
					<option value="typescript">typescript</option>
					<option value="react">react</option>
					<option value="mac">mac</option>
					<option value="node.js">node.js</option>
					<option value="tools">tools</option>
					<option value="css">css</option>
				</datalist>
			</div>
			<div class="row row--two-columns required">
				<label for="slug">Slug</label>
				<input name="slug" placeholder="my-first-post">
			</div>
			<div class="row row--two-columns required">
				<label for="content">Content</label>
				<textarea required rows="10" cols="50" name="content" placeholder="You can use Markdown"></textarea>
			</div>
			<button>Publish</button>
		</form>
		<script>
			const form = document.querySelector('form');
			let posts;
			document.querySelector('#new-post').addEventListener('click', () => {
				form.querySelector('input[type=hidden]').remove();
				form.reset();
			})
			document.querySelector('select').addEventListener('change', (e) => {
				const id = e.target.value;
				const post = posts.find(post => post._id === id);
				populateForm(post, id);
			});

			function populateForm(post, id) {
				const formFields = form.querySelectorAll('input, textarea');
				formFields.forEach((input) => {
					input.value = post[input.getAttribute('name')];
				});

				// add a hidden input field for id
				const input = `<input type="hidden" name="post_id" value="${id}">`
				const inputElm = new DOMParser().parseFromString(input, 'text/html').body.firstChild;
				console.log(inputElm);
				form.append(inputElm);
			}

			fetch('/api/blog').then((res) => res.json()).then((json)=>{
				console.log(json);
				posts = json;
				let options = '';
				json.forEach((doc) => {
					options += `<option value=${doc._id}>${doc.title}</option>`;
				});
				const optionsDOM = new DOMParser().parseFromString(options, 'text/html').body.children;
				console.log(optionsDOM);
				document.querySelector('select').append(...optionsDOM);
			})
		</script>
	</article>

</main>
